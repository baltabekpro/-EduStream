# Техническая инвентаризация и архитектура EduStream (Sprint 5)

## 1. Карта файловой структуры

### Глобальные модули
*   **`src/App.tsx`**: Корневой компонент. Содержит конфигурацию роутинга, Layout приложения и провайдеры контекста (`ToastProvider`, `CourseProvider`).
*   **`src/lib/storage.ts`**: Слой доступа к данным (Repository Pattern). Абстрагирует получение данных от компонентов. Сейчас использует `setTimeout` для имитации асинхронности и возвращает данные из `mockData.ts`.
*   **`src/data/mockData.ts`**: "Единый источник правды" для моковых данных. Содержит статические JSON-объекты для всех разделов.

### Компоненты (`src/components/`)
*   **`Sidebar.tsx`**: Основная навигация.
    *   *Функции:* Переключение страниц, отображение профиля пользователя, кнопка выхода.
    *   *Ключевая особенность:* Содержит селектор выбора активного курса (Context Writer).
*   **`Toast.tsx`**: Система глобальных уведомлений.
    *   *Функции:* Отображает всплывающие сообщения (Success/Error/Info) в правом нижнем углу.

### Страницы (`src/pages/`)
*   **`Login.tsx`**: Страница аутентификации.
    *   *Роль:* Точка входа. Валидация email, выбор метода входа (пароль/магическая ссылка).
*   **`Dashboard.tsx`**: Главная страница учителя.
    *   *Роль:* Сводка активности, быстрый доступ к задачам. Реагирует на смену курса.
*   **`OCR.tsx`**: Рабочее пространство проверки заданий.
    *   *Роль:* Просмотр скана, редактирование распознанного текста, выставление оценки.
*   **`Analytics.tsx`**: Раздел статистики.
    *   *Роль:* Визуализация данных (Recharts), фильтрация по темам, drill-down (детальный просмотр) студентов.
*   **`AIWorkspace.tsx`**: Чат с ИИ и анализ документов.
    *   *Роль:* Симуляция общения с LLM, отображение структуры документа, "умные" действия.
*   **`Settings.tsx`**: Настройки профиля.
    *   *Роль:* Форма редактирования данных пользователя (статичная верстка).

---

## 2. Схема навигации и роутинга

Библиотека: `react-router-dom` v7.

### Маршруты (Routes)
| Путь | Компонент | Доступ | Описание |
| :--- | :--- | :--- | :--- |
| `/login` | `Login` | Public | Редирект на Dashboard после успеха |
| `/dashboard` | `Dashboard` | Protected | Layout с Sidebar |
| `/ocr` | `OCR` | Protected | Проверка работ |
| `/analytics` | `Analytics` | Protected | Аналитика |
| `/ai` | `AIWorkspace` | Protected | ИИ Ассистент |
| `/settings` | `Settings` | Protected | Настройки |
| `/` | - | - | Редирект на `/login` |

### Переходы (Triggers)
1.  **Dashboard -> OCR**:
    *   Клик по карточке в секции "Требует проверки".
    *   Клик по кнопке "Проверить работы" в хедере.
    *   Клик по строке таблицы "Недавняя активность" (если тип activity === 'quiz' | 'ocr').
2.  **Dashboard -> AIWorkspace**:
    *   Клик по строке таблицы "Недавняя активность" (если тип activity === 'plan' | 'ai').
3.  **Sidebar**: Прямые переходы на все защищенные роуты.
4.  **Login -> Dashboard**: При успешной валидации формы.

---

## 3. Управление состоянием (State Management)

### Глобальное состояние (Context API)
1.  **`CourseContext`**:
    *   *Хранит:* `selectedCourse` ('9A' | '10B').
    *   *Использование:* Изменяется в `Sidebar`, читается в `Dashboard` и `Analytics` для фильтрации данных.
2.  **`ToastContext`**:
    *   *Хранит:* Массив активных уведомлений.
    *   *Использование:* Вызывается через хук `useToast()` на всех интерактивных страницах для обратной связи.

### Локальное состояние (useState) & Данные
Данные загружаются через `lib/storage.ts` в `useEffect` при монтировании компонентов.

*   **Dashboard**:
    *   `data`: Объект dashboardData (фильтруется по курсу).
    *   `loading`: Булевый флаг загрузки.
*   **OCR**:
    *   `questions`: Массив вопросов (текст редактируется локально).
    *   `manualScore`: Числовое значение оценки.
    *   `imageError`: Состояние ошибки загрузки изображения (для UI-тестов).
    *   `zoom`: Уровень масштабирования изображения.
*   **Analytics**:
    *   `selectedTopic`: Строка (null или название темы) — открывает Sidebar справа.
    *   `sortOrder`: Режим сортировки ('default' | 'asc' | 'desc').
*   **AIWorkspace**:
    *   `messages`: Массив истории чата.
    *   `isAnalyzing`: Состояние "анализа документа" при входе.
    *   `isGenerating`: Состояние "ИИ печатает".

---

## 4. Инвентаризация интерактивных элементов

### Forms & Inputs
*   **Login**:
    *   Input Email (валидация regex).
    *   Input Password (валидация длины).
    *   Переключатель метода входа (Tab).
*   **OCR**:
    *   `contentEditable` div: Редактирование распознанного текста (`onBlur` обновляет стейт).
    *   Input "Оценка": Числовой ввод.
    *   Textarea "Комментарий": Текстовое поле.
*   **AIWorkspace**:
    *   Input Chat: Текстовое поле для отправки сообщений.
    *   Chips ("Quick Actions"): Кнопки быстрых команд над инпутом.

### Actions (Обработчики)
*   **OCR**:
    *   `handleSave`: Вызывает `storage.saveOCRResult` -> Toast "Сохранено".
    *   `ConfidenceWord` (Tooltip): Клик по подчеркнутому слову открывает меню замены слова.
*   **Analytics**:
    *   `handleClassChange`: (в будущем) Смена класса через дропдаун (сейчас завязано на глобальный контекст).
    *   `toggleSort`: Изменяет порядок тем.
    *   Клик по карточке темы: Открывает боковую панель (Drill-down).
*   **AIWorkspace**:
    *   `handleSendMessage`: Добавляет сообщение юзера -> Запускает таймер имитации печати ИИ -> Добавляет ответ.

### API Facade (`lib/storage.ts`)
Функции готовы к замене на вызовы Firestore:
1.  `getUser()`: Возвращает профиль учителя.
2.  `getDashboardData(courseId)`: Возвращает данные дашборда, отфильтрованные по ID курса.
3.  `getAnalytics(courseId)`: Возвращает статистику по курсу.
4.  `getOCRData()`: Возвращает данные конкретного студента (пока одного).
5.  `getAIDocument()`: Возвращает контент документа для AI страницы.
6.  `saveOCRResult(id, text, score)`: Имитирует асинхронную запись (возвращает Promise<true>).

---

## 5. Описание UI Kit и стилизации

### Технологический стек
*   **Tailwind CSS**: Основной инструмент стилизации.
*   **Material Symbols Outlined**: Иконочный шрифт (подключается через Google Fonts).

### Дизайн-система
*   **Цветовая палитра (Dark Mode Only)**:
    *   Background: `#0f172a` (Slate-900).
    *   Surface: `#1e293b` (Slate-800).
    *   Primary: `#1152d4` (Blue).
    *   Border: `#334155` (Slate-700).
*   **Эффекты**:
    *   `backdrop-blur`: Иснользуется в хедерах страниц, модальных окнах и тултипах.
    *   `animate-fade-in` / `animate-slide-in-right`: Кастомные анимации в `tailwind.config` (внутри index.html).
*   **Адаптивность**:
    *   Sidebar: Скрывается на мобильных (`hidden md:flex`), открывается через гамбургер-меню (Overlay).
    *   Сетки: Использование `grid-cols-1 md:grid-cols-2 lg:grid-cols-3`.
    *   Скроллбары: Кастомизированные webkit-скроллбары (тонкие, в цвет темы).

### Особенности UX
*   **Typing Indicator**: Анимация трех точек при генерации ответа ИИ.
*   **Confidence Score UI**: Пунктирное подчеркивание для слов с низкой уверенностью распознавания.
*   **Feedback**: Toast-уведомления на все ключевые действия сохранения/изменения.
